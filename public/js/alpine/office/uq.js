function setDiscountRecursive(t){let a=document.querySelector("#globalDiscount");if(isNaN(a.value)||""==a.value)return pnotify("Error","Discount is not a valid number","error");t.data.subject_list.forEach((t=>{t.discount=parseFloat(a.value);let e=document.querySelector("[data-discount='"+t.id+"']");e&&(e.value=t.discount)}))}function addDiscount(t,a,e){let o=t.data.subject_list.find((t=>t.id==a));o&&(o.discount=parseFloat(e.value))}function loadDepartments(t,a){t.departmentList=[];let e=window.urlBag.departmentList;a&&(t.loading=!0,axios.get(e+a).then((a=>{t.loading=!1,t.departmentList=a.data.data})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")})))}function loadCourses(t,a){t.courses=[];let e=window.urlBag.courseList;a&&(t.loading=!0,axios.get(e+a).then((a=>{t.loading=!1,t.courseList=a.data.data})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")})))}function toggleItem(t,a,e){if(a.target.checked)t.data.subject_list.push(e);else{let a=t.data.subject_list.findIndex((t=>e.id==t.id));a>=0&&t.data.subject_list.splice(a,1)}}function loadSubjects(t){let a=urlBag.subjects;t.loading=!0,axios.get(a).then((a=>{t.loading=!1,t.subjectList=a.data.data,t.data.subjects&&t.subjectList.forEach((a=>{let e=t.data.subjects.findIndex((t=>a.id==t.subject_id));e>=0&&(a.discount=t.data.subjects[e].discount)}))})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")}))}function loadInfo(t,a=null){a?(t.loading=!0,axios.get(urlBag.base+"/"+a).then((a=>{t.loading=!1,t.data=a.data.data,t.data.subject_list=t.data.subjects.map((t=>(t.subject.discount=t.discount,t.subject))),loadSubjects(t),loadDepartments(t,t.data.university_id),loadCourses(t,t.data.uni_department_id)})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")}))):(loadSubjects(t),t.data.syllabus_id=window.dataBag.last_syllabus)}window.init=()=>({data:{discount:0,active:!0,subject_list:[]},url:urlBag.base,loading:!1,subjectList:[],departmentList:[],courseList:[],submitted:!0,validator:window.$validator(document.getElementById("dataForm")),save:function(t){if(!t.validator.validate())return;if(0==t.data.subject_list.length)return pnotify("Error","Please select at least one subject.","error");let a="post",e=t.url;t.data.id&&(a="put",e+="/"+t.data.id),t.loading=!0,axios({method:a,url:e,data:t.data}).then((a=>{t.loading=!1,pnotify("Success",a.data.message,"success"),window.setTimeout((()=>{window.location=a.data.url}),1e3)})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")}))},deleteItem:function(t){swal({title:"Delete Qualification",text:"Do you want to delete this record?",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Delete"}).then((a=>{!0===a&&(t.loading=!0,axios.delete(t.url+"/"+t.data.id).then((a=>{t.loading=!1,pnotify("Success",a.data.message,"success"),window.setTimeout((()=>{window.location=a.data.url}),1e3)})).catch((a=>{t.loading=!1,pnotify("Error",t.validator.formatServerMessage(a.response),"error")})))})).catch((()=>{}))}});
